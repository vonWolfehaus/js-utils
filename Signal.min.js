(function(){var i=this,t=function(i,t,e,n,s){this._listener=t,this._isOnce=e,this.context=n,this._signal=i,this._priority=s||0};t.prototype={active:!0,params:null,execute:function(i){var t,e;return this.active&&this._listener&&(e=this.params?this.params.concat(i):i,t=this._listener.apply(this.context,e),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},t.prototype.constructor=t;var e=function(){this._bindings=[],this._prevParams=null;var i=this;this.dispatch=function(){e.prototype.dispatch.apply(i,arguments)}};e.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(i,t){if("function"!=typeof i)throw new Error("Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))},_registerListener:function(i,e,n,s){var r,o=this._indexOfListener(i,n);if(-1!==o){if(r=this._bindings[o],r.isOnce()!==e)throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(e?"Once":"")+"() the same listener without removing the relationship first.")}else r=new t(this,i,e,n,s),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},_addBinding:function(i){var t=this._bindings.length;do t--;while(this._bindings[t]&&i._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,i)},_indexOfListener:function(i,t){for(var e,n=this._bindings.length;n--;)if(e=this._bindings[n],e._listener===i&&e.context===t)return n;return-1},has:function(i,t){return-1!==this._indexOfListener(i,t)},add:function(i,t,e){return this.validateListener(i,"add"),this._registerListener(i,!1,t,e)},addOnce:function(i,t,e){return this.validateListener(i,"addOnce"),this._registerListener(i,!0,t,e)},remove:function(i,t){this.validateListener(i,"remove");var e=this._indexOfListener(i,t);return-1!==e&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)),i},removeAll:function(i){"undefined"==typeof i&&(i=null);for(var t=this._bindings.length;t--;)i?this._bindings[t].context===i&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();i||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var i,t=Array.prototype.slice.call(arguments),e=this._bindings.length;if(this.memorize&&(this._prevParams=t),e){i=this._bindings.slice(),this._shouldPropagate=!0;do e--;while(i[e]&&this._shouldPropagate&&i[e].execute(t)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Signal=e):"undefined"!=typeof define&&define.amd?define(e):i.Signal=e}).call(this);